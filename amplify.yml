version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "Installing frontend dependencies..."
        - cd frontend
        - npm ci
    build:
      commands:
        - echo "Building application..."
        - npm run build
        - echo "Retrieving API key from AWS Secrets Manager..."
        - RIOT_API_KEY=$(aws secretsmanager get-secret-value --secret-id rift-rewind-clean/riot-api-key --region $AWS_DEFAULT_REGION --query SecretString --output text)
        - echo "Injecting API key into built files..."
        - sed -i "s#YOUR_RIOT_API_KEY_HERE#$RIOT_API_KEY#g" dist/app.js
        - echo "API key injection completed"
    postBuild:
      commands:
        - echo "Deployment completed"
  artifacts:
    baseDirectory: frontend/dist
    files:
      - '**/*'
  cache:
    paths:
      - frontend/node_modules/**/*
